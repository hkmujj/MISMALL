<include file="Public:header" />
</head>
<style>
	html, body, ul, li {
		border: 0 none;
		list-style: outside none none;
		margin: 0;
		padding: 0;
	}
	#wrapper {
		background-color: #f9f9f9;
		border: 2px solid #fff;
		border-radius: 10px;
		box-shadow: 0 0 3px #aaa;
		margin: 20px auto;
		overflow: hidden;
	}
	.step-pane {
		float: left;
		height: 600px;
	}
	/**左边分步操作css start**/

	.term {
		float: left;
		height: 1800px;
		box-shadow: 0 0 3px #aaa;
		background-color: #0A70A7;
		color: #FFFFFF
	}
	.term .span1 .check-mode-query {
		height: 300px;
		line-height: 300px;
		text-align: center;
		font-size: 30px;
		cursor: pointer
	}
	.term .span1 .check-mode-query:hover {
		background-color: #248ac1;
	}
	.term .check-form {
		height: 600px;
	}
	.term .span2 .form-list {
		height: 550px
	}
	.term .span2 .form-list .ul-form-list li {
		height: 30px;
		margin: 5px 0;
		cursor: pointer;
		font-size: 15px;
		line-height: 30px;
		text-align: center;
		width: 100%;
	}
	.term .span2 .form-list .ul-form-list li:hover {
		background-color: #248ac1;
	}
	.term .span2 .check-form {
		background-color: #248ac1;
		height: 30px;
		text-align: center;
	}
	.term .span3 .input-list {
		height: 535px
	}
	.term .span3 .save-query {
		height: 30px;
		background-color: #248ac1;
		margin-top: -40px;
		cursor: pointer;
		text-align: center
	}
	.term .span3 .add-query-con {
		cursor: pointer;
		margin-top: 10px;
		text-align: center
	}
	.term .span3 .input-list .ul-input-list .condition {
		margin: 3px 0
	}
	.check-form-next {
		height: 30px;
		background-color: #248ac1;
		margin-top: -12px;
		text-align: center;
		cursor: pointer
	}
	.check-form-prev {
		height: 30px;
		background-color: #248ac1;
		text-align: center;
		cursor: pointer
	}
	/*.input-list .ul-input-list div {margin-top: 5px;}

	 .input-list .ul-input-list .search-div {display: table;float: left;margin: 3px 0;position: relative;table-layout: fixed;height: 30px;width: 100%}
	 .input-list .ul-input-list .search-div .value .change_Tj {border: 0 solid #CCCCCC;border-radius: 3px 0 0 3px;box-shadow: 0 0 3px #CCCCCC;display: table-cell;float: left;font-size: 12px;padding: 5px 0;position: absolute;text-indent: 0;top: 1px;left: 52px;width: 45px;}
	 .input-list .ul-input-list .search-div .add-condition {opacity: 1; cursor: pointer; margin-left: 10px}
	 /**end 左边分步操作css**/

	/**右边显示数据css start**/
	.view-data {
		float: left;
		height: 600px;
	}
	.right_data_header li {
		display: table-cell;
		float: none;
		height: 49px;
	}
	.right_data_header li span.title {
		background: none repeat scroll 0 0 #0e9ed0;
		color: #fff;
		display: block;
		float: left;
		font-size: 14px;
		font-weight: bold;
		line-height: 30px;
		overflow: hidden;
		white-space: nowrap;
		width: 130px;
	}
	.right_data_header li, .right_data_content li {
		border-right: 1px dotted #ccc;
		float: left;
		min-width: 130px;
		position: relative;
		text-indent: 4px;
		width: 130px;
	}
	.right_data_content {
		border-bottom: 1px solid #ddd;
		display: table;
		min-width: 10px;
	}
	.right_data_content li {
		display: table-cell;
		float: none;
		height: 26px;
		line-height: 26px;
		max-width: 130px;
		overflow: hidden;
		position: relative;
		white-space: nowrap;
		width: 130px;
	}
	.right_data_header, .right_data_content {
		border-bottom: 1px solid #ddd;
		display: table;
		min-width: 10px;
	}
	.right_data_header li span.delete {
		background-repeat: no-repeat;
		cursor: pointer;
		display: block;
		float: left;
		height: 16px;
		opacity: 0.3;
		position: absolute;
		right: 1px;
		top: 3px;
		width: 16px;
		z-index: 100;
	}
	.view-data .view-data-list {
		width: 100%;
		height: 60%;
		text-align: center;
		overflow: scroll
	}
	.view-data .view-data-condition {
		width: 100%;
		height: 40%
	}
	.view-data .view-data-condition .view-data-conditionTile {
		background-color: #d1d1d1;
		box-shadow: 0 0 3px;
	}
	.view-data .view-data-condition .condition-conter ul li {
		float: left;
		height: 30px;
		margin: 4px;
		width: 100%;
	}
	.view-data .view-data-condition .condition-conter ul li .value {
		position: relative;
	}
	.view-data .view-data-condition .condition-conter ul li .tit {
		background: none repeat scroll 0 0 #0e9ed0;
		border-radius: 2px;
		color: #fff;
		display: block;
		float: left;
		font-size: 14px;
		font-weight: bold;
		line-height: 30px;
		margin-left: 10px;
		overflow: hidden;
		text-indent: 8px;
		white-space: nowrap;
		width: 120px;
	}
	.view-data .view-data-condition .condition-conter ul li .value .change_Tj {
		border: 0 solid #CCCCCC;
		border-radius: 3px 0 0 3px;
		box-shadow: 0 0 3px #CCCCCC;
		display: table-cell;
		position: absolute;
		float: left;
		font-size: 12px;
		padding: 5px 0;
		text-indent: 0;
		top: -5px;
		left: 1px;
		width: 70px;
	}
	.view-data .view-data-condition .condition-conter ul li .selecCon {
		border: 0 solid #cccccc;
		border-radius: 3px 0 0 3px box-shadow :3px #cccccc;
		padding: 5px 0;
		display: table-cell;
	}
	.view-data table td, .view-data table th {
		border-right: 1px dotted #ccc;
		border-bottom: 1px dotted #ccc;
	}
	.view-data .view-data-condition .condition-conter ul li  .add-condition {
		left: 5px;
		cursor: pointer;
	}
	.view-data .view-data-condition .condition-conter ul li  .addselect {
		border: 0 solid #cccccc;
		border-radius: 3px 0 0 3px;
		box-shadow: 0 0 3px #cccccc;
		display: table-cell;
		font-size: 12px;
		left: 1px;
		padding: 5px 0;
		text-indent: 0;
		width: 49px;
	}
	/**end  右边显示数据css**/

	/*****数据保存 start*****/
	.save-content {
		text-align: center;
	}
	.sourceDataInput {
		color: #000000;
	}
	.tableInputContent {
		background: none repeat scroll 0 0 #e0ecff;
		border: 1px solid #0e9ed0;
		border-radius: 2px;
		float: left;
		outline: medium none;
		padding: 6px 20px 6px 4px;
		width: 120px;
	}
	/*******数据保存 end*******/
</style>
<body>
	<div>
		<header>
			<h1>数据筛选</h1>
		</header>
		<div id="rootwizard">
			<div id="wrapper" >
				<div class="step-pane" id="tab2" >
					<div class="term" style="">
						<div class="check-form span1">
							<div class="check-mode-query single-table" >
								单表查询
							</div>
							<div class="check-mode-query multilist" >
								多表查询
							</div>
						</div>
						<div class="check-form span2">
							<div class="change-form check-form-prev">
								上一步
							</div>
							<div class="form-list" >
								<ul class="ul-form-list">
									<li>
										表单1
									</li>
									<li>
										表单1
									</li>
									<li>
										表单1
									</li>
									<li>
										表单1
									</li>
									<li>
										表单1
									</li>
									<li>
										表单1
									</li>
								</ul>
							</div>
							<div class="check-form-next">
								下一步
							</div>
						</div>
						<div class="add-term check-form span3"  >
							<div class="check-form-prev">
								上一步
							</div>
							<div class="add-query-con">

								<div id="addCondition">
									<button class="btn btn-default btn" type="button">
										<span class="glyphicon glyphicon-plus"></span>添加条件
									</button>
								</div>
							</div>
							<div class="input-list">
								<div class="ul-input-list">

								</div>
							</div>
							<div class="save-query">
								保存
							</div>
						</div>
					</div>
					<div   class="view-data" style="background-color: #EDEDF0" >
						<div class="view-data-list">
							<span class="view-data-tip">
								<p>
									数据显示区域 <h3>←请点击左边选择查询方式</h3>
								</p></span>
							<div class="delField" style="display:none;text-align: left;">
								需要恢复的字段
								<select id="delField" >
									<option value="">请选择需要恢复的字段</option>
								</select>
							</div>
						</div>
						<div class="view-data-condition">
							<div class="view-data-conditionTile">
								数据条件设置
							</div>
							<div class="condition-conter">
								<ul class="right_where_column">
									<li>
										<span class="tit" title="文本框2">文本框2</span><span class="value">
											<select class="change_Tj">
												<option value="0">包含 </option><option value="1">大于</option><option value="2">小于 </option><option value="3">等于</option><option value="4">小于等于 </option><option value="5">大于等于</option>
											</select>
											<input class="input change_val form form-control input-sm" type="text" style="width:20%;text-indent: 70px;"/>
										</span><span class="glyphicon glyphicon-plus add-condition"></span>
									</li>

								</ul>
							</div>
						</div>

					</div>
				</div>

			</div>

		</div>
		<div>
			<!-- Modal -->
			<div id="asd" aria-hidden="false" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="mySys" class="modal fade in" style="display: none;">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button data-dismiss="modal" class="close" type="button">
								<span aria-hidden="true">×</span><span class="sr-only">Close</span>
							</button>
							<h4 id="myModalLabel" class="modal-title">选择需要的表单控件</h4>
						</div>
						<div class="modal-body">
							<div data-options="iconCls: 'icon-save'" id="select_fields" style="overflow: auto;">
								<table style="border-collapse: none;">
									<tbody>
										<tr>
											<td align="left" style="width:100px;color:#0E9E12;font-size:16px;" class="cc_tbfm201410231126092820">
											<input type="checkbox" field="main" name="cc_tbfm201410231126092820">
											44</td><td>
											<li>
												<input type="checkbox" name="cc_tbfm201410231126092820" field="CCTextBox" value="CCTextBox2">
												<a>文本框2</a>
											</li>
											<li>
												<input type="checkbox" name="cc_tbfm201410231126092820" field="CCTextBox" value="CCTextBox3">
												<a>文本框3</a>
											</li>
											<li>
												<input type="checkbox" name="cc_tbfm201410231126092820" field="CCTextBox" value="CCTextBox4">
												<a>文本框4</a>
											</li>
											<li>
												<input type="checkbox" name="cc_tbfm201410231126092820" field="CCTime" value="CCTime5">
												<a>日期5</a>
											</li>
											<li>
												<input type="checkbox" name="cc_tbfm201410231126092820" field="CCTextBox" value="CCTextBox6">
												<a>文本框6</a>
											</li></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="modal-footer">
							<button class="btn btn-primary selectConfirm" type="button">
								确定
							</button>
							<button data-dismiss="modal" class="btn btn-default" type="button">
								取消
							</button>

						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="save-modal"></div>
		<footer >

		</footer>
	</div>
	<script src="__PUBLIC__/Js/bootstrap/js/bootstrap-wizard.min.js"></script>
	<script>
		$(document).ready(function() {
			//设置自适应宽度
			var screenWidth = $(document).width();
			$("#wrapper").css({
				"width" : screenWidth + "px"
			});
			$(".step-pane").animate({
				width : screenWidth + "px",
			}, 500, function() {

			});
			$(".term").css({

				"width" : screenWidth * 0.2 + "px"
			});
			$(".view-data").css({
				"width" : screenWidth * 0.8 + "px"
			});

			var stepsWidth = 0;
			var current = 1;
			var widths = new Array();

			$(".check-mode-query,.check-form-prev").on("click", function() {
				$(".term").stop().animate({
					marginTop : '-600px',
				}, 500, function() {

				});
			});
			$(".check-form-next").on("click", function() {
				$(".term").stop().animate({
					marginTop : '-1200px',
				}, 500, function() {

				});
			});
			$(".change-form").on("click", function() {
				$(".term").stop().animate({
					marginTop : '0px',
				}, 500, function() {

				});
			});
			//点击筛选字段事件
			$(".add-query-con").on("click", function() {
				$("#asd").modal('show');
			});
			//筛选后关闭窗口
			$(".selectConfirm").on("click", function() {
				$(".view-data-condition").append('<div class="search-div"><span class="title">文本kuang</span><span class="value"><select class="change_Tj">	<option value="0">包含 </option><option value="1">大于</option><option value="2">小于 </option><option value="3">等于</option><option value="4">小于等于 </option><option value="5">大于等于</option></select><input class="input change_val form form-control input-sm" type="text" style="width:20%;text-indent: 70px;"/></span><span class="glyphicon glyphicon-plus add-condition"></span></div>');
				$("#asd").modal('hide');
			});

			//点击单表查询
			$(".single-table").on("click", function() {
				$(".view-data").find(".view-data-list").children().remove();
				$(".span2").find(".form-list>ul").show();
				$(".span2").find(".form-list>.plan").hide();
				$(".view-data > .view-data-list").append('<ul style="height: 32px;" class="right_data_header"><li type="CCTextBox" fieldname="CCTextBox2"><span class="title">文本框2</span><span class="delete">X</span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li><li type="CCTextBox" fieldname="CCTextBox3"><span class="title">文本框3</span><span class="delete">X</span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li><li type="CCTextBox" fieldname="CCTextBox4"><span class="title">文本框4</span><span class="delete">X</span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li><li type="CCTextBox" fieldname="CCTextBox5"><span class="title">文本框5</span><span class="delete">X</span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li><li type="CCTextBox" fieldname="CCTextBox6"><span class="title">文本框6</span><span class="delete"></span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li><li type="CCTextBox" fieldname="CCTextBox7"><span class="title">文本框7</span><span class="delete"></span><div class="opt"><a><img class="orderBythis" title="按此列排序" src="/public/App/Designer/Query/Images/px.png"><img class="cat" title="按此列分组" src="/public/App/Designer/Query/Images/fz.png"><img class="sum" title="按此列求和" src="/public/App/Designer/Query/Images/qh.png"><img class="max" title="求最大值" src="/public/App/Designer/Query/Images/max.png"><img class="min" title="求最小值" src="/public/App/Designer/Query/Images/min.png"><img class="avg" title="求平均值" src="/public/App/Designer/Query/Images/pj.png"></a></div></li></ul><ul class="right_data_content"><li fieldname="CCTextBox2">额戴菲菲</li><li fieldname="CCTextBox3"></li><li fieldname="CCTextBox4"></li><li fieldname="CCTextBox5"></li><li fieldname="CCTextBox6"></li><li fieldname="CCTextBox7"></li></ul><ul class="right_data_content"><li fieldname="CCTextBox2">额戴菲菲</li><li fieldname="CCTextBox3"></li><li fieldname="CCTextBox4"></li><li fieldname="CCTextBox5"></li><li fieldname="CCTextBox6"></li><li fieldname="CCTextBox7"></li></ul><ul class="right_data_content"><li fieldname="CCTextBox2">额戴菲菲</li><li fieldname="CCTextBox3"></li><li fieldname="CCTextBox4"></li><li fieldname="CCTextBox5"></li><li fieldname="CCTextBox6"></li><li fieldname="CCTextBox7"></li></ul><ul class="right_data_content"><li fieldname="CCTextBox2">额戴菲菲</li><li fieldname="CCTextBox3"></li><li fieldname="CCTextBox4"></li><li fieldname="CCTextBox5"></li><li fieldname="CCTextBox6"></li><li fieldname="CCTextBox7"></li></ul>');
			});
			//点击多表查询

			$(".multilist").on("click", function() {
				$(".view-data").find(".view-data-list").children().remove();
				$(".span2").find(".form-list>ul").hide();
				$(".span2").find(".plan").remove();
				$(".span2 >.form-list").append('<div class="plan" style="width:100%;height:35px;text-align:center;line-height:35px">可用的备选方案</div>');
				$(".view-data").find(".view-data-list").append('<table><tbody><tr style="text-align:center;"><th>1</th><th>2</th></tr><tr class="secondTr"><td class="title"><input type="text" class="tableInputContent form-control input-sm" from="keyinput" placeholder="请输入需要信息"></td><td class="title"><input type="text" class="tableInputContent  form-control input-sm"  from="" placeholder="请输入需要信息"></td></tr></tbody></table>');
				//绑定点击增加事件
				$('.view-data').delegate(".secondTr", "click", function() {
				});
			});
			//删除当前事件
			$(".view-data").undelegate(" .right_data_header .delete", "click").delegate(".right_data_header .delete", "click", function() {
				//alert($(".view-data .right_data_header").find("li:visible").length);
				if ($(".view-data .right_data_header").find("li:visible").length < 2) {

					return;
				}
				var controlName = $(this).parents("li").attr("fieldname");
				$(".view-data-list").find("li[fieldname='" + controlName + "']").hide();
				//$(this).parents("li").hide();
				var vals = $(this).parents("li").find(">.title").text();

				$("#delField").append('<option value="' + controlName + '">' + vals + '</option>');
				checkdelField();
			});
			//继续添加筛选条件事件
			$(".view-data").undelegate(" .add-condition", "click").delegate(".add-condition", "click", function() {
				$control = $(this).parents("li:first").find("input");
				var result = IsAddCondition($control);
				if (result == true) {
					var $addselect = $('<li><select class="selecCon"><option value="0">并且 </option><option value="1">或者</option></select><span class="tit" style="background:#ededf0">&nbsp;</span><span class="value"><select class="change_Tj"><option value="0">包含 </option><option value="1">大于</option><option value="2">小于 </option><option value="3">等于</option><option value="4">小于等于 </option><option value="5">大于等于</option></select><input type="text" style="width:20%;text-indent: 70px;" class="input change_val form form-control input-sm"></span><span class="glyphicon glyphicon-minus min-condition"></span></li>');
					$(this).parents(".right_where_column").append($addselect);
				} else {
					console.log(result);
					result.parent().find('.error-condition').remove();
					result.append('<span class = "error-condition">请输入条件</span>');

				}

			});
			/**
			 * 根据事件类型添加控件
			 * @param control Object 第一个输入控件
			 **/
			function IsAddCondition($control) {
				//查找在此控件之前的所有的控件是否有为空的
				var result = "";
				if (($control.parents("li").nextAll().size() == 0)) {
					if ($.trim($control.val()) == "")
						result = $control;
					else
						result =  true;
				} else {
					if ($.trim($control.val()) == "") {
						return $control;
					} else {
						$control.parents("li").nextAll().each(function() {
							if ($.trim($(this).find("input").val()) == "") {
								result = $(this);
								return false;
							} else {
								result = true;
							}
						});
					}
				}
				return result;
			}

			//点击恢复去掉的字段 单表模式
			$("#delField").on("change", function() {
				if ($(this).val() != "") {
					var $fieldValue = $(this).val();
					//alert($fieldValue);
					$(this).find('option[value=' + $fieldValue + ']').remove();
					$(".view-data").find('li[fieldname="' + $fieldValue + '"]').show();
					//$(".right_data").find('li[fieldname="' + $fieldValue + '"]').css("display", "block");
					//显示字段
					//system._initGetSql();
					checkdelField();
					//检查 是否影藏
				}
			});

			//保存查询事件
			function checkdelField() {
				if ($("#delField").find("option").length > 1) {
					$(".delField").show();
				} else {
					$(".delField").hide();
				}
			}

			$(".save-query").on("click", function(e) {
				var dlgObj = $("#dlg");
				if (dlgObj.length > 0) {
				} else {
					$(".save-modal").append('<div id="dlg" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">' + '  <div class="modal-dialog modal-sm">' + '    <div class="modal-content save-content">' + '<div class="modal-header"><h4 class="modal-title">数据源保存</h4></div>' + ' <div class="modal-body sourceDataInput">数据源名称:<input type="text" id="submitsourcename" style="width:180px;border: 1px solid #0E9ED0;border-radius: 2px;"/></span>' + '<div id="validTip">请输入数据源名称</div></div>' + '<div class="modal-footer">' + '<button type="button" class="btn btn-primary">确定</button>' + '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button></div></div>  </div></div>');
					//$("#saveDlg").append('<div id="dlg" class="easyui-dialog" title="Toolbar and Buttons" style="padding:10px"><br/><span style="margin-left:10px;padding-top:20px;">数据源名称:<input type="text" id="submitsourcename" style="width:180px;border: 1px solid #0E9ED0;border-radius: 2px;"/></span>' + '<div id="validTip">请输入数据源名称</div></div>');
				}
				$("#dlg").modal("show");

			});
		});
	</script>
</body>

</html>
